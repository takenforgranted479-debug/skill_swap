{% extends 'base.html' %}
{% load static %}

{% block title %}Request Details - Campus Skill-Swap{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="gradient-bg relative overflow-hidden">
    <div class="absolute inset-0 bg-black opacity-20"></div>
    <div class="relative container mx-auto px-4 py-20">
        <div class="text-center text-white">
            <h1 class="text-4xl lg:text-5xl font-bold mb-6 leading-tight">
                Request <span class="text-yellow-300">Details</span>
            </h1>
            <p class="text-lg lg:text-xl mb-8 max-w-3xl mx-auto">
                Comprehensive information about this skill swap request
            </p>
        </div>
    </div>
</section>

<!-- Request Details Section -->
<section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            
            <!-- Status and Actions -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex items-center gap-4 mb-4 lg:mb-0">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-handshake text-white text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">
                                {{ request.offered_skill.skill.name }}
                            </h2>
                            <p class="text-gray-600">
                                {% if is_requester %}
                                    Your request to {{ other_user.get_full_name|default:other_user.username }}
                                {% else %}
                                    Request from {{ other_user.get_full_name|default:other_user.username }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <span class="px-4 py-2 text-lg font-medium rounded-full
                            {% if request.status == 'pending' %}bg-yellow-100 text-yellow-800
                            {% elif request.status == 'accepted' %}bg-green-100 text-green-800
                            {% elif request.status == 'declined' %}bg-red-100 text-red-800
                            {% elif request.status == 'cancelled' %}bg-gray-100 text-gray-800
                            {% else %}bg-blue-100 text-blue-800{% endif %}">
                            <i class="fas fa-circle mr-2 text-xs"></i>
                            {{ request.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Column: Request Information -->
                <div class="space-y-6">
                    
                    <!-- Basic Information -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                            Request Information
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-3">
                                <i class="fas fa-graduation-cap text-blue-600 mt-1"></i>
                                <div>
                                    <span class="font-semibold text-gray-700">Skill:</span>
                                    <p class="text-gray-600">{{ request.offered_skill.skill.name }}</p>
                                    {% if request.offered_skill.skill.category %}
                                        <p class="text-sm text-gray-500">Category: {{ request.offered_skill.skill.category.name }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-3">
                                <i class="fas fa-clock text-purple-600 mt-1"></i>
                                <div>
                                    <span class="font-semibold text-gray-700">Proposed Duration:</span>
                                    <p class="text-gray-600">{{ request.proposed_duration }} minutes</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-3">
                                <i class="fas fa-{{ request.proposed_format|yesno:'video,map-marker' }} text-green-600 mt-1"></i>
                                <div>
                                    <span class="font-semibold text-gray-700">Format:</span>
                                    <p class="text-gray-600">{{ request.get_proposed_format_display }}</p>
                                </div>
                            </div>
                            
                            {% if request.proposed_location %}
                                <div class="flex items-start gap-3">
                                    <i class="fas fa-location-dot text-red-600 mt-1"></i>
                                    <div>
                                        <span class="font-semibold text-gray-700">Proposed Location:</span>
                                        <p class="text-gray-600">{{ request.proposed_location }}</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Timeline Information -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-calendar-alt text-orange-600 mr-3"></i>
                            Timeline
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
                                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                <div class="flex-1">
                                    <p class="font-semibold text-gray-700">Request Created</p>
                                    <p class="text-sm text-gray-500">{{ request.created_at|date:"M d, Y \a\t h:i A" }}</p>
                                    <p class="text-xs text-gray-400">{{ request.created_at|timesince }} ago</p>
                                </div>
                            </div>
                            
                            {% if request.responded_at %}
                                <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
                                    <div class="w-3 h-3 
                                        {% if request.status == 'accepted' %}bg-green-500
                                        {% elif request.status == 'declined' %}bg-red-500
                                        {% else %}bg-gray-500{% endif %} rounded-full"></div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-700">
                                            {% if request.status == 'accepted' %}Request Accepted
                                            {% elif request.status == 'declined' %}Request Declined
                                            {% elif request.status == 'cancelled' %}Request Cancelled
                                            {% else %}Response Received{% endif %}
                                        </p>
                                        <p class="text-sm text-gray-500">{{ request.responded_at|date:"M d, Y \a\t h:i A" }}</p>
                                        <p class="text-xs text-gray-400">{{ request.responded_at|timesince }} ago</p>
                                    </div>
                                </div>
                            {% endif %}
                            
                            {% if request.expires_at and request.status == 'pending' %}
                                <div class="flex items-center gap-3">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-700">Expires</p>
                                        <p class="text-sm text-gray-500">{{ request.expires_at|date:"M d, Y \a\t h:i A" }}</p>
                                        <p class="text-xs 
                                            {% if request.is_expired %}text-red-600{% else %}text-yellow-600{% endif %}">
                                            {% if request.is_expired %}Expired{% else %}{{ request.expires_at|timeuntil }} remaining{% endif %}
                                        </p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    {% if related_session %}
                        <!-- Related Session -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-chalkboard text-green-600 mr-3"></i>
                                Scheduled Session
                            </h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-calendar text-blue-600"></i>
                                    <span class="font-semibold">Date:</span>
                                    <span>{{ related_session.scheduled_date|date:"M d, Y \a\t h:i A" }}</span>
                                </div>
                                
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-clock text-purple-600"></i>
                                    <span class="font-semibold">Duration:</span>
                                    <span>{{ related_session.duration_minutes }} minutes</span>
                                </div>
                                
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-circle text-sm 
                                        {% if related_session.status == 'scheduled' %}text-blue-600
                                        {% elif related_session.status == 'completed' %}text-green-600
                                        {% elif related_session.status == 'cancelled' %}text-red-600
                                        {% else %}text-gray-600{% endif %}"></i>
                                    <span class="font-semibold">Status:</span>
                                    <span>{{ related_session.get_status_display }}</span>
                                </div>
                                
                                <div class="mt-4">
                                    <a href="{% url 'skill_sessions:session_detail' related_session.id %}" 
                                       class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-eye mr-2"></i>View Session Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Right Column: User Information and Actions -->
                <div class="space-y-6">
                    
                    <!-- User Profile -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-user text-green-600 mr-3"></i>
                            {% if is_requester %}Learning From{% else %}Teaching To{% endif %}
                        </h3>
                        
                        <div class="flex items-start gap-4">
                            <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                                {% if other_user.profile.profile_picture %}
                                    <img src="{{ other_user.profile.profile_picture.url }}" 
                                         alt="{{ other_user.username }}" 
                                         class="w-16 h-16 object-cover">
                                {% else %}
                                    <i class="fas fa-user text-gray-600 text-xl"></i>
                                {% endif %}
                            </div>
                            
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800">
                                    <a href="{% url 'accounts:profile_details' other_user.id %}" 
                                       class="hover:text-blue-600 transition-colors">
                                        {{ other_user.get_full_name|default:other_user.username }}
                                    </a>
                                </h4>
                                {% if other_user.profile.bio %}
                                    <p class="text-gray-600 text-sm mt-1">{{ other_user.profile.bio|truncatewords:20 }}</p>
                                {% endif %}
                                
                                <div class="flex items-center gap-4 mt-3 text-sm text-gray-500">
                                    {% if other_user.profile.department %}
                                        <span><i class="fas fa-building mr-1"></i>{{ other_user.profile.department }}</span>
                                    {% endif %}
                                    {% if other_user.profile.year %}
                                        <span><i class="fas fa-calendar mr-1"></i>{{ other_user.profile.get_year_display }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="mt-3">
                                    <a href="{% url 'accounts:profile_details' other_user.id %}" 
                                       class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200 transition-colors">
                                        <i class="fas fa-eye mr-1"></i>View Full Profile
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages -->
                    {% if request.message or request.response_message %}
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-comments text-purple-600 mr-3"></i>
                                Messages
                            </h3>
                            
                            {% if request.message %}
                                <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-paper-plane text-blue-600"></i>
                                        <span class="font-semibold text-blue-800">Original Request Message</span>
                                    </div>
                                    <p class="text-gray-700">"{{ request.message }}"</p>
                                    <p class="text-xs text-gray-500 mt-2">
                                        From {{ request.requester.get_full_name|default:request.requester.username }}
                                    </p>
                                </div>
                            {% endif %}
                            
                            {% if request.response_message %}
                                <div class="p-4 
                                    {% if request.status == 'accepted' %}bg-green-50
                                    {% elif request.status == 'declined' %}bg-red-50
                                    {% else %}bg-gray-50{% endif %} rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas fa-reply 
                                            {% if request.status == 'accepted' %}text-green-600
                                            {% elif request.status == 'declined' %}text-red-600
                                            {% else %}text-gray-600{% endif %}"></i>
                                        <span class="font-semibold 
                                            {% if request.status == 'accepted' %}text-green-800
                                            {% elif request.status == 'declined' %}text-red-800
                                            {% else %}text-gray-800{% endif %}">
                                            Response Message
                                        </span>
                                    </div>
                                    <p class="text-gray-700">"{{ request.response_message }}"</p>
                                    <p class="text-xs text-gray-500 mt-2">
                                        From {{ request.recipient.get_full_name|default:request.recipient.username }}
                                    </p>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}

                    <!-- Actions -->
                    {% if request.status == 'pending' %}
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-cogs text-orange-600 mr-3"></i>
                                Actions
                            </h3>
                            
                            <div class="space-y-3">
                                {% if is_requester %}
                                    <a href="{% url 'skill_sessions:request_cancel' request.id %}" 
                                       class="w-full inline-flex items-center justify-center px-4 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                        <i class="fas fa-times mr-2"></i>Cancel Request
                                    </a>
                                {% else %}
                                    <a href="{% url 'skill_sessions:request_respond' request.id %}?action=accept" 
                                       class="w-full inline-flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors">
                                        <i class="fas fa-check mr-2"></i>Accept Request
                                    </a>
                                    <a href="{% url 'skill_sessions:request_reject' request.id %}" 
                                       class="w-full inline-flex items-center justify-center px-4 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                        <i class="fas fa-times mr-2"></i>Reject Request
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Navigation -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-arrow-left text-blue-600 mr-3"></i>
                            Quick Navigation
                        </h3>
                        
                        <div class="space-y-2">
                            {% if is_requester %}
                                <a href="{% url 'skill_sessions:request_list' %}" 
                                   class="w-full inline-flex items-center justify-center px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
                                    <i class="fas fa-list mr-2"></i>My Requests
                                </a>
                            {% else %}
                                <a href="{% url 'skill_sessions:received_requests' %}" 
                                   class="w-full inline-flex items-center justify-center px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
                                    <i class="fas fa-inbox mr-2"></i>Received Requests
                                </a>
                            {% endif %}
                            
                            <a href="{% url 'skill_sessions:my_sessions' %}" 
                               class="w-full inline-flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                <i class="fas fa-calendar-alt mr-2"></i>My Sessions
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}